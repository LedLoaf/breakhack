sudo: required
dist: trusty
language: c
cache: ccache
compiler:
    - gcc
    - clang

env:
    global:
        - secure: "sM7ZGPk1dw74Ujy/JmEoJoPlVtFX3OOioEPfRDKHxW0KTlyy3vV7+zVbGZ74SoktCoLJHIFL86kN3MfX4R3FyKiOGbvDn+f6/AbsJlCnx7CtIbgjds0JA18PA1njPHAVG2po1Bdi6H8txtgPkOpjmMETvVnJPQep1uxr8Y0bViIUay8izeLn4hv02p/ZpLrtfXCcDvn5CwwPk98cELfZJPWJi3VM7JYHat4pb5M1dUoo3GcaMpWQS2B22uimU3cF76GL+IFn9hgZLJsxeQeCj0Ju7NVV1qp34tthgalfSc//ETj+EilIeh8PAuImGQyBdjav3eErC9RP6bI1OjDSoX9FEruUNhnf8kXhrFvk+poOPjBWCg7WPv5rXdhKPyPaVH7apfV+V6572obkyP9wNKWTUQOSW35XmmsEaeMSPrmbQ6t9vR2w35o3Fd0IFdy0IIAYU1KRuC1c3VT3KUKwCKsuXROXqxkxNHJ1i4IF4TV0Egl3t2chOaTqwqiY+6+6wjMw3mfIQxd96SSYKUBCi9H9uBC2H/YCIIp8hznbWAs4mfqw0eEYliI0NFvLbIIOYHNiYTEqQvFM9kmDZsyRljP6zak+Zp62Mp5Bv1zwi8+VIzr9Ig7jmrA0G4f3rJQbnICDNaLpf1Y5lqRjVazxzUyisp+ZdY+ZYyDJyBnen9g="

before_install:
    - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
    - sudo add-apt-repository -y ppa:zoogie/sdl2-snapshots
    - sudo add-apt-repository -y ppa:george-edison55/cmake-3.x
    - sudo add-apt-repository -y ppa:h-rayflood/llvm

      #g++4.9
    - if [ "$CXX" = "g++" ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; fi

      #clang 4.0 
    - if [ "$CXX" == "clang++" ]; then wget -O - http://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -; fi
    - if [ "$CXX" == "clang++" ]; then sudo add-apt-repository -y "deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-4.0 main"; fi

    - sudo apt-get update -qq

install:
    - sudo apt-get install -y libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev
    - sudo apt-get install -y cmake cmake-data check lua5.2 liblua5.2-dev

      #g++6
    - if [ "$CXX" = "g++" ]; then sudo apt-get install -y g++-6; fi
    - if [ "$CXX" = "g++" ]; then export CXX="g++-6" CC="gcc-6"; fi

      #clang 4.0
    - if [ "$CXX" == "clang++" ]; then sudo apt-get install -y clang-4.0; fi
    - if [ "$CXX" == "clang++" ]; then export CXX="clang++-4.0"; fi

script:
    - mkdir build
    - cd build
    - cmake --version
    - cmake -DCMAKE_BUILD_TYPE=Debug ..
    - make
    - make test

addons:
    coverity_scan:
        project:
            name: "LiquidityC/breakhack"
            description: "A rougelike game, inspired by Nethack"
        notification_email: linus.probert@gmail.com
        build_command_prepend: "mkdir -p build;cd build;cmake -DCMAKE_BUILD_TYPE=Debug .."
        build_command: "make"
        branch_pattern: coverity_scan
